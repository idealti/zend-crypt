<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Strong cryptography tools and password hashing.">  
    <link rel="canonical" href="https://docs.zendframework.com/block-cipher/">
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Block Ciphers - zend-crypt - Zend Framework Docs</title>

    <link rel="stylesheet" href="/css/styles.css">
</head>
<body id="page-top">

    
    <div class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">

            
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-tooltip data-placement="bottom" title="Go to the ZF homepage">
                    <img src="../img/zend-framework-logo.svg" height="28" alt="Zend Framework">
                </a>
            </span>
        </div>

        <div class="navbar-collapse collapse">

            
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://framework.zend.com/about">About</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/downloads">Install</a>
                </li>
                <li class="active">
                    <a href="https://docs.zendframework.com">Documentation</a>
                </li>
                <li>
                    <a href="https://www.zend.com/en/services/training">Training</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/blog">Blog</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/participate">Participate</a>
                </li>
            </ul>

            
            
                <div class="nav navbar-nav navbar-collapse visible-xs-block ">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="..">zend-crypt</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../intro/" class="subnavigation__link">Introduction</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Reference</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Block Ciphers</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../files/" class="subnavigation__link">Encrypting Files</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../hybrid/" class="subnavigation__link">Hybrid Cryptosystem</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../key-derivation/" class="subnavigation__link">Key Derivation</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../password/" class="subnavigation__link">Password</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../public-key/" class="subnavigation__link">Public Key Cryptography</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="nav navbar-nav navbar-collapse visible-xs-block">
                <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</div>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-xs-8">
                <h1 class="header__title">
                    Documentation

                    
                        <small class="header__subtitle">zend-crypt</small>
                    
                </h1>
            </div>

            
            <div class="col-xs-4 text-right">
                
                    

                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/zendframework/zend-crypt/" class="header__link header__link--github" title="Go to repository of zend-crypt">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="laminas-announcement">
    <div class="container">
        <div class="row">
            <div class="col-xs-12"><strong>
                This package has moved. Visit its replacement, <a href="https://docs.laminas.dev/laminas-crypt/">laminas/laminas-crypt.</a>
            </strong></div>
        </div>
    </div>
</div>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-xs-12 content" role="main">
            <!-- content:begin -->
                
                    <ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
    <li><a href="https://framework.zend.com/">Home</a></li>

    
        <li><a href="https://docs.zendframework.com/">Documentation</a></li>

        
            <li><a href="..">zend-crypt</a></li>

            
                
                    
                    
                        <li>Reference</li>
                    
                
            

            <li class="active">Block Ciphers</li>
        
    
</ol>






    
    
        <h2 class="chapter__headline">Reference</h2>
    

    <div>
        
    

    
    
        <div class="toc">
            <h6 class="toc__headline">In This Article</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#using-gcm-or-ccm-mode-from-php-71" class="toc__link">Using GCM or CCM Mode from PHP 7.1+</a>
                    </li>
                
            </ul>
        </div>
    

    </div>

    <h1 id="block-ciphers">Block Ciphers</h1>
<p><code>Zend\Crypt\BlockCipher</code> implements encrypt-then-authenticate mode using
<a href="http://en.wikipedia.org/wiki/HMAC">HMAC</a> to provide authentication.</p>
<p>The symmetric cipher can be chosen with a specific adapter that implements
<code>Zend\Crypt\Symmetric\SymmetricInterface</code>. We support the symmmetric encryption
algorithms offered by <a href="http://php.net/manual/en/book.openssl.php">OpenSSL</a> and
<a href="http://php.net/manual/en/book.mcrypt.php">Mcrypt</a> extensions.</p>
<p>In the following code, we detail an example of using the <code>BlockCipher</code> class to
encrypt-then-authenticate a string using the
<a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES-256</a> block cipher
and the HMAC algorithm (using the <a href="http://en.wikipedia.org/wiki/SHA-2">SHA-256</a>
hash function).</p>
<blockquote>
<h3>Mcrypt</h3>
<p>The Mcrypt extension is based on the libmcrypt library. Unfortunately, at the
time of writing, the project is dead, having been unmaintained for around 8
years, with the last release (version 2.5.8) having occurred in February 2007.</p>
<p>Starting with PHP 7.1, the Mcrypt extension will be
<a href="https://wiki.php.net/rfc/mcrypt-viking-funeral">considered deprecated</a>.
For these reasons, <strong>we strongly suggest using only the Openssl adapter</strong>.</p>
<p>Starting with zend-crypt 3.0, the Openssl adapter is the default (for example,
by <code>Zend\Crypt\FileCipher</code>), and all examples now only demonstrate that
adapter.</p>
</blockquote>
<pre><code class="language-php">use Zend\Crypt\BlockCipher;

$blockCipher = BlockCipher::factory('openssl', array('algo' =&gt; 'aes'));
$blockCipher-&gt;setKey('encryption key');
$result = $blockCipher-&gt;encrypt('this is a secret message');
echo &quot;Encrypted text: $result\n&quot;;
</code></pre>

<p>The <code>BlockCipher</code> instance is initialized using a factory method with the name
of the cipher adapter to use (e.g., <code>openssl</code>) and the parameters to pass to the adapter
(the AES algorithm). In order to encrypt a string, we need to specify an
encryption key, which we do via the <code>setKey()</code> method. Encryption is performed
with the <code>encrypt()</code> method.</p>
<p>The output of encryption is a string, encoded in Base64 (default), containing
the HMAC value, the IV vector, and the encrypted text. The encryption mode used
is <a href="http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation#Cipher-block_chaining_.28CBC.29">CBC</a>
(with a random <a href="http://en.wikipedia.org/wiki/Initialization_vector">IV</a> by
default), with the default HMAC hash algorithm of SHA256.  The Openssl adapter
encrypts using the <a href="http://en.wikipedia.org/wiki/Padding_%28cryptography%29">PKCS#7 padding</a>
mechanism by default. You can specify a different padding method using a special
adapter (<code>Zend\Crypt\Symmetric\Padding</code>). The encryption and authentication keys
used by <code>BlockCipher</code> are generated with the <a href="http://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a>
algorithm, used as the key derivation function from the user's key specified
using the <code>setKey()</code> method.</p>
<blockquote>
<h3>Key Size</h3>
<p>BlockCipher always attempts to use the longest key size for the specified
cipher. For instance, for the AES algorithm it uses 256 bits, and for the
<a href="http://en.wikipedia.org/wiki/Blowfish_%28cipher%29">Blowfish</a> algorithm it
uses 448 bits.</p>
</blockquote>
<p>You can change all the default settings by passing the values to the factory
parameters. For instance, if you want to use the Blowfish algorithm, with the
CFB mode and the HMAC SHA512 hash function, initialize the class as follows:</p>
<pre><code class="language-php">use Zend\Crypt\BlockCipher;

$blockCipher = BlockCipher::factory(
    'openssl',
    [
        'algo' =&gt; 'blowfish',
        'mode' =&gt; 'cfb',
        'hash' =&gt; 'sha512'
    ]
);
</code></pre>

<blockquote>
<h3>Recommendation</h3>
<p>If you are not familiar with symmetric encryption techniques, we strongly
suggest using the default values of the <code>BlockCipher</code> class. The default
values are: AES algorithm, CBC mode, HMAC with SHA256, PKCS#7 padding.</p>
</blockquote>
<p>To decrypt a string we can use the <code>decrypt()</code> method. In order to successfully
decrypt a string, we must configure the <code>BlockCipher</code> with the same parameters
used during encryption.</p>
<p>We can also initialize the <code>BlockCipher</code> manually without using the factory method;
we can inject the symmetric cipher adapter directly via the constructor.
For instance, we can rewrite the previous example as follows:</p>
<pre><code class="language-php">use Zend\Crypt\BlockCipher;
use Zend\Crypt\Symmetric\Openssl;

$blockCipher = new BlockCipher(new Openssl(['algo' =&gt; 'aes']));
$blockCipher-&gt;setKey('encryption key');
$result = $blockCipher-&gt;encrypt('this is a secret message');
echo &quot;Encrypted text: $result \n&quot;;
</code></pre>

<h2 id="using-gcm-or-ccm-mode-from-php-71">Using GCM or CCM Mode from PHP 7.1+</h2>
<p>If you are using PHP 7.1+ you can choose the GCM or CCM mode for authenticated
encryption with OpenSSL. These modes provide authenticated encryption by itself,
without the usage of HMAC as described in the previous section.</p>
<p>GCM is <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Galois/Counter Mode</a>
and CCM is <a href="https://en.wikipedia.org/wiki/CCM_mode">Counter with CBC-MAC</a>.
For more information on the usage of this encryption modes in PHP we suggest to
read <a href="http://www.zimuel.it/authenticated-encrypt-with-openssl-and-php-7-1/">this blog post</a>.</p>
<p>If you want to use the GCM or CCM mode with <code>BlockCipher</code> you can just specify
the mode in the factory. For instance, the following is an example of
<code>aes-256-gcm</code> encryption with OpenSSL:</p>
<pre><code class="language-php">use Zend\Crypt\BlockCipher;

$blockCipher = BlockCipher::factory(
    'openssl',
    [
        'algo' =&gt; 'aes',
        'mode' =&gt; 'gcm'
    ]
);
</code></pre>

<p>And below is an example demonstrating the factory for <code>aes-256-ccm</code> algorithm:</p>
<pre><code class="language-php">use Zend\Crypt\BlockCipher;

$blockCipher = BlockCipher::factory(
    'openssl',
    [
        'algo' =&gt; 'aes',
        'mode' =&gt; 'ccm'
    ]
);
</code></pre>

<blockquote>
<h3>Recommendation</h3>
<p><strong>GCM mode is about 3x faster than CCM</strong>, we recommend using GCM unless
you have requirements that dictate CCM.</p>
</blockquote>




    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../intro/">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../files/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>




    <div class="help-wanted">
        <p>
            Found a mistake or want to contribute to the documentation?
            <a href="https://github.com/zendframework/zend-crypt/edit/master/docs/book/block-cipher.md" target="_blank" class="help-wanted__link">
                Edit this page on GitHub!
            </a>
        </p>
    </div>

                
            <!-- content:end -->
            </div>
            <div class="col-md-3 col-xs-12 sidebar">
                
                    <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="..">zend-crypt</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../intro/" class="subnavigation__link">Introduction</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Reference</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Block Ciphers</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../files/" class="subnavigation__link">Encrypting Files</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../hybrid/" class="subnavigation__link">Hybrid Cryptosystem</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../key-derivation/" class="subnavigation__link">Key Derivation</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../password/" class="subnavigation__link">Password</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../public-key/" class="subnavigation__link">Public Key Cryptography</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <h5>Zend Framework</h5>
                <ul>
                    <li><a href="https://framework.zend.com/">framework.zend.com</a></li>
                    <li><a href="https://docs.zendframework.com">docs.zendframework.com</a></li>
                    <li><a href="https://packages.zendframework.com">packages.zendframework.com</a></li>
                    <li><a href="https://apigility.org">apigility.org</a></li>
                    <li><a href="https://getexpressive.org/">getexpressive.org</a></li>
                </ul>
            </div>
        </div>

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">

            
            <div class="col-md-9">
                <h4 class="footer__headline">Copyright</h4>
                <p>&copy; 2006-2020 by <a href="https://www.zend.com/">Zend</a> by <a href="https://www.perforce.com/">Perforce</a>.</p>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://laminas.dev/chat/" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/zendframework" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/zfdevteam" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

<nav class="cookie-bar navbar navbar-fixed-bottom navbar-default hidden">
    <div class="container">
        <p class="navbar-text">
            We use cookies to allow you to dismiss dialogs such as the Laminas
            Project notification.
        </p>
        <button type="button" class="cookie-button btn btn-default navbar-btn">Allow Cookies</button>
    </div>
</nav>

    <script>
        var base_url = '..',
            siteName = 'zend-crypt';
    </script>
    <script src="/js/scripts.js"></script>
    <script src="../search/main.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>



</body>


</html>
